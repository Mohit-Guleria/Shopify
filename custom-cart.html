{% layout 'theme' %}

<div id="custom-cart-page">
  <div class="container">
    <h1>Your Shopping Cart</h1>
    <div id="cart-items" class="cart-items-container"></div>
    <div class="cart-summary" id="cart-summary">
      <button onclick="window.location.href='/checkout'" id="checkout-button" class="btn checkout">Proceed to Checkout</button>
      <button onclick="window.location.href='/shop'" id="shop-button" class="btn shop">Go to Shop</button>
    </div>
    <div class="footer-text">
      <p>Developed by <strong>Mohit Guleria</strong></p>
    </div>
  </div>
</div>

<style>
/* Page Background and Container */
#custom-cart-page {
  background-color: #f4f7f9;
  padding: 40px 20px;
  font-family: 'Comic Sans MS', cursive, sans-serif;
  color: #333;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  background: linear-gradient(135deg, #ffffff 0%, #e0eafc 100%);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border-radius: 12px;
  position: relative;
}

/* Header */
h1 {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
  font-size: 28px;
}

/* Cart Items Container */
.cart-items-container {
  margin-bottom: 30px;
}

/* Individual Cart Item */
.cart-item {
  border-bottom: 1px solid #ddd;
  padding: 15px;
  display: flex;
  align-items: flex-start;
  margin-bottom: 15px;
  background-color: #ffffff;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
  transition: background-color 0.3s ease, transform 0.3s ease;
}

.cart-item:hover {
  background-color: #f1f5f9;
  transform: scale(1.02);
}

.cart-item img {
  width: 120px;
  height: auto;
  border-radius: 6px;
  margin-right: 20px;
}

.cart-item-details {
  flex: 1;
  margin-right: 20px;
}

.cart-item h3 {
  margin: 0;
  font-size: 22px;
  color: #333;
}

.cart-item p {
  margin: 5px 0;
  color: #555;
}

/* Description Container */
.description-container {
  display: none;
  position: absolute;
  top: 15px;
  left: 140px;
  background-color: #fff;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  max-width: 250px;
  z-index: 10;
  font-size: 14px;
  color: #333;
}

.cart-item:hover .description-container {
  display: block;
}

/* Quantity Container */
.quantity-container {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  justify-content: center;
  margin-left: 20px;
  position: relative;
}

.quantity-container label {
  font-size: 16px;
  color: #333;
  margin-bottom: 5px;
}

.quantity-container input {
  width: 60px;
  text-align: center;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
  margin-bottom: 10px;
}

/* Update Quantity and Remove Item Buttons */
.button-container {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}

.update-variant,
.remove-item {
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
  border: none;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.update-variant {
  background-color: #4CAF50; /* Green color */
  color: white;
  margin-right: 10px;
}

.update-variant:hover {
  background-color: #45a049;
  transform: scale(1.05);
}

.remove-item {
  background-color: #f44336; /* Red color */
  color: white;
}

.remove-item:hover {
  background-color: #e53935;
  transform: scale(1.05);
}

/* Variant Dropdown Container */
.variant-dropdown-container {
  position: relative;
  width: 100%;
  margin: 10px 0;
}

/* Variant Dropdown Styling */
.variant-select {
  padding: 10px 15px;
  border-radius: 8px;
  border: 2px solid #ddd;
  background-color: #fff;
  font-size: 16px;
  color: #333;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  cursor: pointer;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  width: 100%;
}

/* Dropdown Appearance when Focused */
.variant-select:focus {
  border-color: #4CAF50; /* Green border on focus */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  outline: none;
}

/* Dropdown Options Styling */
.variant-select option {
  padding: 10px 15px;
  background-color: #fff;
  color: #333;
  font-size: 16px;
}

/* Hover Effect for Options */
.variant-select option:hover {
  background-color: #f0f0f0;
}

/* Cart Summary */
.cart-summary {
  text-align: center;
  margin-top: 20px;
}

/* Checkout Button */
.btn {
  display: inline-block;
  padding: 12px 24px;
  font-size: 16px;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  text-decoration: none;
  text-align: center;
  margin: 10px;
  transition: background-color 0.3s ease;
}

.checkout {
  background-color: #28a745;
}

.checkout:hover {
  background-color: #218838;
}

.shop {
  background-color: #007bff;
}

.shop:hover {
  background-color: #0056b3;
}

/* Footer Text */
.footer-text {
  position: absolute;
  bottom: 10px;
  right: 20px;
  text-align: right;
  font-size: 14px;
  color: #888;
}

.footer-text p {
  margin: 0;
  font-size: 16px;
  color: #666;
}

.footer-text strong {
  color: #333;
}

/* Empty Cart Message */
.empty-cart-message {
  text-align: center;
  font-size: 18px;
  color: #555;
  margin-top: 50px;
  background-color: #ffffff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.empty-cart-message img {
  width: 80px;
  margin-bottom: 15px;
}

.empty-cart-message h2 {
  font-size: 24px;
  color: #333;
  margin-bottom: 10px;
}

.empty-cart-message p {
  font-size: 16px;
  color: #666;
}

.empty-cart-message .btn {
  display: block;
  width: 200px;
  margin: 20px auto;
}
</style>

<script>
function formatMoney(amount) {
  amount = Number(amount) / 100;
  return `$${amount.toFixed(2)}`;
}

document.addEventListener('DOMContentLoaded', function() {
    updateCartDisplay();

    // Handle variant update button clicks
    document.getElementById('cart-items').addEventListener('click', function(event) {
        if (event.target.matches('.update-variant')) {
            const itemKey = event.target.dataset.itemKey;
            const selectedSize = document.getElementById(`size-${itemKey}`).value;
            const selectedColor = document.getElementById(`color-${itemKey}`).value;
            console.log(`Update variant for item ${itemKey} with size ${selectedSize} and color ${selectedColor}`);
        }
        if (event.target.matches('.remove-item')) {
            const itemId = event.target.dataset.id;
            removeItemFromCart(itemId);
        }
        if (event.target.matches('.update-quantity')) {
            const itemKey = event.target.dataset.itemKey;
            const quantity = document.getElementById(`quantity-${itemKey}`).value;
            updateItemQuantity(itemKey, quantity);
        }
    });

    // Function to update cart display
    function updateCartDisplay() {
        fetch('/cart.js')
            .then(response => response.json())
            .then(cart => {
                const cartItemsContainer = document.getElementById('cart-items');
                const checkoutButton = document.getElementById('checkout-button');
                const shopButton = document.getElementById('shop-button');
                cartItemsContainer.innerHTML = '';

                if (cart.items.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="empty-cart-message">
                            <img src="/path/to/empty-cart-image.png" alt="Empty Cart">
                            <h2>Your cart is empty</h2>
                            <p>It looks like you haven't added any items to your cart yet.</p>
                            <a href="/" class="btn">Continue Shopping</a>
                        </div>
                    `;
                    checkoutButton.style.display = 'none';
                    shopButton.style.display = 'inline-block'; // Show shop button
                    return;
                }

                checkoutButton.style.display = 'inline-block'; // Show checkout button
                shopButton.style.display = 'none'; // Hide shop button

                cart.items.forEach(item => {
                    if (item.product_id && item.variant_id) {
                        fetch(`/products/${item.handle}.js`)
                            .then(response => response.json())
                            .then(product => {
                                const sizeOptions = [];
                                const colorOptions = [];
                                
                                product.variants.forEach(variant => {
                                    const sizeOption = variant.options[0];
                                    const colorOption = variant.options[1];

                                    if (!sizeOptions.includes(sizeOption)) {
                                        sizeOptions.push(sizeOption);
                                    }
                                    if (!colorOptions.includes(colorOption)) {
                                        colorOptions.push(colorOption);
                                    }
                                });

                                const selectedVariant = product.variants.find(variant => variant.id === item.variant_id);

                                const cartItemHTML = `
                                    <div class="cart-item">
                                        <img src="${item.image}" alt="${item.title}">
                                        <div class="cart-item-details">
                                            <h3>${item.title}</h3>
                                            <p>${formatMoney(item.price)}</p>
                                            <div class="description-container">${item.description}</div>
                                            <div class="variant-dropdown-container">
                                                <label for="size-${item.key}">Size</label>
                                                <select id="size-${item.key}" class="size-select" data-item-key="${item.key}">
                                                    ${sizeOptions.map(size => `
                                                        <option value="${size}" ${selectedVariant.options[0] === size ? 'selected' : ''}>${size}</option>
                                                    `).join('')}
                                                </select>
                                                
                                                <label for="color-${item.key}">Color</label>
                                                <select id="color-${item.key}" class="color-select" data-item-key="${item.key}">
                                                    ${colorOptions.map(color => `
                                                        <option value="${color}" ${selectedVariant.options[1] === color ? 'selected' : ''}>${color}</option>
                                                    `).join('')}
                                                </select>

                                                <div class="button-container">
                                                    <button class="update-variant" data-item-key="${item.key}">Update Variant</button>
                                                    <button class="remove-item" data-id="${item.key}">Remove Item</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="quantity-container">
                                            <label for="quantity-${item.key}">Quantity</label>
                                            <input type="number" id="quantity-${item.key}" name="quantity" value="${item.quantity}" min="1" data-key="${item.key}" class="quantity-input">
                                            <button class="update-quantity" data-item-key="${item.key}">Update Quantity</button>
                                        </div>
                                    </div>
                                `;

                                cartItemsContainer.insertAdjacentHTML('beforeend', cartItemHTML);
                            })
                            .catch(error => console.error('Error fetching product data:', error));
                    } else {
                        console.error('Missing product information:', item);
                    }
                });
            })
            .catch(error => console.error('Error fetching cart data:', error));
    }

    function removeItemFromCart(itemId) {
        fetch(`/cart/change.js`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: itemId,
                quantity: 0
            })
        })
        .then(response => response.json())
        .then(() => {
            updateCartDisplay(); // Update cart display after item removal
        })
        .catch(error => console.error('Error removing item from cart:', error));
    }

    function updateItemQuantity(itemKey, quantity) {
        fetch(`/cart/change.js`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: itemKey,
                quantity: parseInt(quantity, 10)
            })
        })
        .then(response => response.json())
        .then(() => {
            updateCartDisplay(); // Update cart display after quantity change
        })
        .catch(error => console.error('Error updating item quantity:', error));
    }
});
</script>
